<?php
/**
 * This script creates a "fake" (derived) ADOS instrument in the CouchDB
 * data querying tool. This derived instrument contains the scores and metadata
 * for the ADOS that was administered to the candidate, and only that ADOS.
 *
 * PHP Version 5
 *
 *  @category Loris
 *  @package  DQT
 *  @author   Dave MacFarlane <david.macfarlane2@mcgill.ca>
 *  @license  Loris license
 *  @link     https://github.com/aces/Loris-Trunk
 */
require_once 'generic_includes.php';
require_once 'CouchDB.class.inc';
require_once 'Database.class.inc';
require_once 'Utility.class.inc';
require_once 'NDB_Factory.class.inc';
/**
 * Class which implements script to derived fake ADOS instrument and update
 * all CouchDB documents that are appropriate.
 *
 *  @category Loris
 *  @package  DQT
 *  @author   Dave MacFarlane <david.macfarlane2@mcgill.ca>
 *  @license  Loris license
 *  @link     https://github.com/aces/Loris-Trunk
 */
class CouchDBADOSImporter
{
    var $SQLDB; // reference to the database handler, store here instead
    // of using Database::singleton in case it's a mock.
    var $CouchDB; // reference to the CouchDB database handler

public $ADOS_SA_CSS = array("PHI0000,V24"=>"8",
"PHI0002,V24"=>"8",
"PHI0003,V24"=>"8",
"PHI0005,V24"=>"8",
"PHI0006,V24"=>"1",
"PHI0007,V24"=>"2",
"PHI0009,V24"=>"4",
"PHI0010,V24"=>"8",
"PHI0014,V24"=>"6",
"PHI0015,V24"=>"1",
"PHI0016,V24"=>"7",
"PHI0023,V24"=>"3",
"PHI0024,V24"=>"1",
"PHI0040,V24"=>"2",
"PHI0045,V24"=>"1",
"PHI0047,V24"=>"2",
"PHI0050,V24"=>"2",
"PHI0052,V24"=>"6",
"PHI0055,V24"=>"2",
"PHI0058,V24"=>"2",
"PHI0059,V24"=>"2",
"PHI0064,V24"=>"1",
"PHI0068,V24"=>"3",
"PHI0070,V24"=>"1",
"PHI0071,V24"=>"7",
"PHI0072,V24"=>"8",
"PHI0077,V24"=>"1",
"PHI0078,V24"=>"2",
"PHI0081,V24"=>"1",
"PHI0084,V24"=>"1",
"PHI0088,V24"=>"2",
"PHI0089,V24"=>"2",
"PHI0091,V24"=>"2",
"PHI0093,V24"=>"1",
"PHI0096,V24"=>"2",
"PHI0098,V24"=>"2",
"PHI0101,V24"=>"1",
"PHI0106,V24"=>"1",
"PHI0109,V24"=>"1",
"PHI0110,V24"=>"6",
"PHI0112,V24"=>"6",
"PHI0115,V24"=>"2",
"PHI0116,V24"=>"5",
"PHI0117,V24"=>"4",
"PHI0119,V24"=>"1",
"PHI0122,V24"=>"2",
"PHI0125,V24"=>"1",
"PHI0126,V24"=>"1",
"PHI0136,V24"=>"2",
"PHI0139,V24"=>"1",
"PHI0141,V24"=>"1",
"PHI0142,V24"=>"2",
"PHI0144,V24"=>"2",
"PHI0146,V24"=>"1",
"PHI0149,V24"=>"2",
"PHI0150,V24"=>"4",
"PHI0151,V24"=>"2",
"PHI0152,V24"=>"1",
"PHI0153,V24"=>"1",
"PHI0154,V24"=>"2",
"PHI0155,V24"=>"6",
"PHI0159,V24"=>"2",
"PHI0161,V24"=>"1",
"PHI0167,V24"=>"1",
"PHI0170,V24"=>"4",
"PHI0171,V24"=>"6",
"PHI0173,V24"=>"6",
"PHI0176,V24"=>"2",
"PHI0177,V24"=>"3",
"PHI0182,V24"=>"1",
"PHI0187,V24"=>"2",
"PHI0189,V24"=>"1",
"PHI0190,V24"=>"7",
"PHI0192,V24"=>"6",
"PHI0193,V24"=>".",
"PHI0194,V24"=>".",
"PHI0201,V24"=>"1",
"PHI0205,V24"=>"1",
"PHI0206,V24"=>"9",
"PHI0207,V24"=>"2",
"PHI0209,V24"=>"2",
"PHI0212,V24"=>"3",
"PHI0215,V24"=>"3",
"PHI0216,V24"=>"1",
"PHI0217,V24"=>"2",
"PHI0218,V24"=>"3",
"PHI0219,V24"=>"1",
"PHI0221,V24"=>"8",
"PHI0222,V24"=>"2",
"PHI0223,V24"=>"9",
"PHI0224,V24"=>"1",
"PHI0225,V24"=>"5",
"PHI0226,V24"=>"1",
"PHI0235,V24"=>"1",
"PHI0239,V24"=>"1",
"PHI0240,V24"=>"2",
"PHI0241,V24"=>"1",
"PHI0242,V24"=>"5",
"PHI0244,V24"=>"2",
"PHI0246,V24"=>"2",
"PHI0247,V24"=>"2",
"PHI0248,V24"=>"1",
"PHI0250,V24"=>"1",
"PHI0251,V24"=>"2",
"PHI0256,V24"=>"4",
"PHI0260,V24"=>"1",
"PHI0261,V24"=>"2",
"PHI0262,V24"=>"2",
"PHI0263,V24"=>"2",
"PHI0264,V24"=>"1",
"PHI0265,V24"=>"4",
"PHI0272,V24"=>"2",
"PHI0273,V24"=>"5",
"PHI0274,V24"=>"1",
"PHI0275,V24"=>"1",
"PHI0276,V24"=>"1",
"PHI1001,V24"=>"3",
"PHI1005,V24"=>"1",
"PHI1007,V24"=>".",
"PHI1009,V24"=>".",
"PHI1010,V24"=>".",
"PHI1013,V24"=>".",
"PHI1018,V24"=>".",
"PHI1020,V24"=>".",
"PHI1021,V24"=>".",
"PHI1022,V24"=>".",
"PHI1024,V24"=>".",
"PHI1026,V24"=>".",
"PHI1029,V24"=>".",
"PHI1030,V24"=>".",
"PHI1031,V24"=>".",
"PHI1032,V24"=>".",
"PHI1037,V24"=>".",
"PHI1038,V24"=>".",
"PHI1042,V24"=>".",
"PHI1046,V24"=>".",
"PHI1047,V24"=>".",
"PHI1049,V24"=>".",
"PHI1050,V24"=>".",
"PHI1051,V24"=>".",
"PHI1052,V24"=>".",
"PHI1053,V24"=>".",
"PHI1056,V24"=>".",
"PHI1058,V24"=>".",
"SEA0001,V24"=>"4",
"SEA0002,V24"=>"1",
"SEA0004,V24"=>"1",
"SEA0005,V24"=>"3",
"SEA0007,V24"=>"2",
"SEA0008,V24"=>".",
"SEA0009,V24"=>"6",
"SEA0012,V24"=>"3",
"SEA0014,V24"=>"1",
"SEA0015,V24"=>"9",
"SEA0016,V24"=>"1",
"SEA0018,V24"=>"1",
"SEA0022,V24"=>"4",
"SEA0029,V24"=>"1",
"SEA0030,V24"=>"1",
"SEA0032,V24"=>"2",
"SEA0034,V24"=>"2",
"SEA0036,V24"=>"1",
"SEA0037,V24"=>"6",
"SEA0041,V24"=>"3",
"SEA0050,V24"=>"4",
"SEA0060,V24"=>"3",
"SEA0062,V24"=>"1",
"SEA0065,V24"=>"1",
"SEA0067,V24"=>"1",
"SEA0068,V24"=>"4",
"SEA0069,V24"=>"5",
"SEA0072,V24"=>"6",
"SEA0074,V24"=>"2",
"SEA0077,V24"=>"1",
"SEA0078,V24"=>"1",
"SEA0079,V24"=>"2",
"SEA0092,V24"=>"2",
"SEA0099,V24"=>"5",
"SEA0102,V24"=>"1",
"SEA0103,V24"=>"1",
"SEA0106,V24"=>"1",
"SEA0107,V24"=>"4",
"SEA0108,V24"=>"1",
"SEA0110,V24"=>"2",
"SEA0111,V24"=>"2",
"SEA0112,V24"=>"2",
"SEA0117,V24"=>"2",
"SEA0118,V24"=>"1",
"SEA0119,V24"=>"1",
"SEA0120,V24"=>"2",
"SEA0121,V24"=>"3",
"SEA0122,V24"=>"2",
"SEA0123,V24"=>"2",
"SEA0124,V24"=>"1",
"SEA0125,V24"=>"3",
"SEA0130,V24"=>"2",
"SEA0131,V24"=>".",
"SEA0132,V24"=>"1",
"SEA0133,V24"=>".",
"SEA0136,V24"=>"7",
"SEA0137,V24"=>"2",
"SEA0141,V24"=>"6",
"SEA0142,V24"=>"2",
"SEA0143,V24"=>"1",
"SEA0144,V24"=>"1",
"SEA0145,V24"=>"4",
"SEA0147,V24"=>"3",
"SEA0148,V24"=>"2",
"SEA0150,V24"=>"2",
"SEA0151,V24"=>"1",
"SEA0152,V24"=>"3",
"SEA0153,V24"=>"2",
"SEA0154,V24"=>"1",
"SEA0157,V24"=>"2",
"SEA0158,V24"=>"1",
"SEA0160,V24"=>"3",
"SEA0161,V24"=>"1",
"SEA0162,V24"=>"1",
"SEA0163,V24"=>"6",
"SEA0165,V24"=>"1",
"SEA0177,V24"=>"1",
"SEA0178,V24"=>"6",
"SEA0179,V24"=>"1",
"SEA0183,V24"=>"1",
"SEA0184,V24"=>"2",
"SEA0186,V24"=>"1",
"SEA0193,V24"=>"1",
"SEA0194,V24"=>"8",
"SEA0195,V24"=>"2",
"SEA0196,V24"=>"2",
"SEA0197,V24"=>"1",
"SEA0201,V24"=>"1",
"SEA0202,V24"=>"5",
"SEA0210,V24"=>"3",
"SEA0211,V24"=>"1",
"SEA0213,V24"=>"6",
"SEA0214,V24"=>"4",
"SEA0215,V24"=>"2",
"SEA0221,V24"=>"2",
"SEA0222,V24"=>"2",
"SEA0225,V24"=>"3",
"SEA0233,V24"=>"2",
"SEA0235,V24"=>"4",
"SEA0237,V24"=>"1",
"SEA0238,V24"=>"1",
"SEA0245,V24"=>"1",
"SEA0246,V24"=>"2",
"SEA0247,V24"=>"2",
"SEA0250,V24"=>"2",
"SEA0251,V24"=>"2",
"SEA0254,V24"=>"7",
"SEA0257,V24"=>"2",
"SEA0258,V24"=>"2",
"SEA0262,V24"=>"1",
"SEA0268,V24"=>".",
"SEA0269,V24"=>"4",
"SEA1000,V24"=>"1",
"SEA1001,V24"=>"7",
"SEA1004,V24"=>"3",
"SEA1006,V24"=>"3",
"SEA1008,V24"=>"6",
"SEA1009,V24"=>"4",
"SEA1012,V24"=>"1",
"SEA1013,V24"=>"8",
"SEA1017,V24"=>"3",
"SEA1018,V24"=>"1",
"SEA1019,V24"=>"1",
"SEA1020,V24"=>"1",
"SEA1022,V24"=>"2",
"SEA1025,V24"=>".",
"SEA1026,V24"=>"1",
"SEA1027,V24"=>"4",
"SEA1029,V24"=>".",
"SEA1030,V24"=>"3",
"SEA1031,V24"=>"2",
"SEA1032,V24"=>"1",
"SEA1033,V24"=>"5",
"SEA1034,V24"=>"2",
"SEA1036,V24"=>"2",
"SEA1038,V24"=>"8",
"SEA1039,V24"=>"2",
"SEA1040,V24"=>"5",
"SEA1041,V24"=>"3",
"SEA1042,V24"=>".",
"SEA1043,V24"=>"4",
"SEA1044,V24"=>"7",
"SEA1045,V24"=>"6",
"SEA1047,V24"=>"1",
"SEA1048,V24"=>"1",
"SEA1050,V24"=>"2",
"SEA1052,V24"=>"2",
"SEA1054,V24"=>"5",
"SEA1055,V24"=>"4",
"SEA1057,V24"=>".",
"STL0000,V24"=>"2",
"STL0001,V24"=>".",
"STL0002,V24"=>"1",
"STL0003,V24"=>"6",
"STL0004,V24"=>"2",
"STL0005,V24"=>"1",
"STL0006,V24"=>"4",
"STL0007,V24"=>".",
"STL0009,V24"=>"1",
"STL0010,V24"=>"1",
"STL0011,V24"=>"5",
"STL0013,V24"=>"2",
"STL0016,V24"=>"3",
"STL0017,V24"=>"4",
"STL0019,V24"=>".",
"STL0022,V24"=>"1",
"STL0023,V24"=>"1",
"STL0025,V24"=>"1",
"STL0026,V24"=>"5",
"STL0028,V24"=>"6",
"STL0029,V24"=>"1",
"STL0030,V24"=>"2",
"STL0031,V24"=>".",
"STL0032,V24"=>"1",
"STL0034,V24"=>"2",
"STL0038,V24"=>"1",
"STL0040,V24"=>"5",
"STL0044,V24"=>"1",
"STL0045,V24"=>"1",
"STL0046,V24"=>".",
"STL0048,V24"=>"1",
"STL0049,V24"=>"2",
"STL0051,V24"=>"2",
"STL0054,V24"=>"1",
"STL0057,V24"=>"2",
"STL0061,V24"=>"4",
"STL0063,V24"=>"2",
"STL0064,V24"=>"5",
"STL0070,V24"=>"4",
"STL0077,V24"=>"1",
"STL0079,V24"=>"2",
"STL0080,V24"=>"1",
"STL0081,V24"=>"1",
"STL0084,V24"=>"2",
"STL0085,V24"=>"1",
"STL0091,V24"=>"1",
"STL0093,V24"=>"1",
"STL0097,V24"=>"1",
"STL0107,V24"=>"2",
"STL0108,V24"=>"7",
"STL0109,V24"=>"1",
"STL0111,V24"=>"2",
"STL0112,V24"=>"2",
"STL0113,V24"=>".",
"STL0115,V24"=>"5",
"STL0116,V24"=>"1",
"STL0118,V24"=>"2",
"STL0126,V24"=>"5",
"STL0128,V24"=>"2",
"STL0129,V24"=>"1",
"STL0132,V24"=>"1",
"STL0133,V24"=>"9",
"STL0136,V24"=>"4",
"STL0138,V24"=>"2",
"STL0140,V24"=>"1",
"STL0143,V24"=>"5",
"STL0144,V24"=>"1",
"STL0149,V24"=>"2",
"STL0150,V24"=>"1",
"STL0152,V24"=>"2",
"STL0159,V24"=>"3",
"STL0163,V24"=>"1",
"STL0167,V24"=>"2",
"STL0168,V24"=>"1",
"STL0173,V24"=>"1",
"STL0174,V24"=>"1",
"STL0176,V24"=>"6",
"STL0178,V24"=>"1",
"STL0181,V24"=>"1",
"STL0183,V24"=>"3",
"STL0187,V24"=>"1",
"STL0188,V24"=>"1",
"STL0192,V24"=>"1",
"STL0193,V24"=>"9",
"STL0194,V24"=>"6",
"STL0195,V24"=>"2",
"STL0196,V24"=>".",
"STL0198,V24"=>"1",
"STL0199,V24"=>".",
"STL0200,V24"=>"3",
"STL0210,V24"=>"2",
"STL0213,V24"=>"2",
"STL0217,V24"=>"1",
"STL0218,V24"=>"1",
"STL0226,V24"=>"1",
"STL0228,V24"=>"2",
"STL0234,V24"=>"1",
"STL0236,V24"=>"1",
"STL0241,V24"=>"1",
"STL0243,V24"=>"1",
"STL0248,V24"=>"1",
"STL0249,V24"=>"4",
"STL0250,V24"=>"4",
"STL0252,V24"=>"2",
"STL0254,V24"=>".",
"STL0255,V24"=>".",
"STL0257,V24"=>"4",
"STL0258,V24"=>"1",
"STL0260,V24"=>".",
"STL0261,V24"=>"2",
"STL0263,V24"=>"1",
"STL0265,V24"=>"4",
"STL0266,V24"=>"9",
"STL0271,V24"=>"2",
"STL0272,V24"=>"2",
"STL0275,V24"=>"4",
"STL0279,V24"=>"2",
"STL0282,V24"=>"1",
"STL0285,V24"=>".",
"STL0289,V24"=>"6",
"STL0290,V24"=>"1",
"STL0291,V24"=>"5",
"STL0294,V24"=>".",
"STL0298,V24"=>".",
"STL0299,V24"=>"3",
"STL0301,V24"=>"5",
"STL0304,V24"=>"2",
"STL0305,V24"=>"1",
"STL0308,V24"=>"1",
"STL0311,V24"=>"7",
"STL0313,V24"=>"7",
"STL0314,V24"=>"1",
"STL0315,V24"=>"2",
"STL0318,V24"=>"4",
"STL0319,V24"=>"3",
"STL0332,V24"=>"2",
"STL0333,V24"=>"1",
"STL0335,V24"=>"3",
"STL0336,V24"=>"2",
"STL0337,V24"=>"5",
"STL1004,V24"=>"4",
"STL1005,V24"=>"2",
"STL1006,V24"=>"2",
"STL1007,V24"=>"1",
"STL1008,V24"=>"4",
"STL1011,V24"=>".",
"STL1025,V24"=>"2",
"STL1027,V24"=>"2",
"STL1028,V24"=>".",
"STL1030,V24"=>"2",
"STL1033,V24"=>"1",
"STL1034,V24"=>"1",
"STL1036,V24"=>"2",
"STL1037,V24"=>"3",
"STL1039,V24"=>"1",
"STL1043,V24"=>"1",
"STL1044,V24"=>"2",
"STL1045,V24"=>"2",
"STL1050,V24"=>"2",
"STL1051,V24"=>".",
"STL1052,V24"=>"2",
"STL1054,V24"=>".",
"UNC0003,V24"=>"6",
"UNC0005,V24"=>"1",
"UNC0006,V24"=>"1",
"UNC0007,V24"=>"5",
"UNC0011,V24"=>"8",
"UNC0012,V24"=>"4",
"UNC0013,V24"=>"4",
"UNC0015,V24"=>".",
"UNC0016,V24"=>"7",
"UNC0017,V24"=>"4",
"UNC0018,V24"=>"2",
"UNC0019,V24"=>"6",
"UNC0020,V24"=>"2",
"UNC0021,V24"=>"2",
"UNC0022,V24"=>"5",
"UNC0023,V24"=>"3",
"UNC0025,V24"=>"1",
"UNC0027,V24"=>"1",
"UNC0030,V24"=>"2",
"UNC0031,V24"=>"1",
"UNC0032,V24"=>"1",
"UNC0033,V24"=>"1",
"UNC0035,V24"=>"5",
"UNC0040,V24"=>"1",
"UNC0041,V24"=>"1",
"UNC0042,V24"=>"2",
"UNC0044,V24"=>"2",
"UNC0045,V24"=>"1",
"UNC0046,V24"=>"1",
"UNC0048,V24"=>"1",
"UNC0049,V24"=>"1",
"UNC0050,V24"=>"1",
"UNC0051,V24"=>"2",
"UNC0053,V24"=>".",
"UNC0054,V24"=>"1",
"UNC0055,V24"=>"2",
"UNC0057,V24"=>"1",
"UNC0059,V24"=>"2",
"UNC0064,V24"=>"1",
"UNC0065,V24"=>"1",
"UNC0066,V24"=>"3",
"UNC0070,V24"=>"2",
"UNC0071,V24"=>"2",
"UNC0072,V24"=>"2",
"UNC0073,V24"=>"7",
"UNC0074,V24"=>"1",
"UNC0076,V24"=>"5",
"UNC0077,V24"=>"7",
"UNC0078,V24"=>"1",
"UNC0079,V24"=>"1",
"UNC0080,V24"=>"4",
"UNC0084,V24"=>"1",
"UNC0086,V24"=>"10",
"UNC0087,V24"=>"2",
"UNC0088,V24"=>"1",
"UNC0090,V24"=>"1",
"UNC0091,V24"=>"6",
"UNC0092,V24"=>"2",
"UNC0094,V24"=>"6",
"UNC0095,V24"=>"2",
"UNC0096,V24"=>"2",
"UNC0097,V24"=>"2",
"UNC0099,V24"=>".",
"UNC0100,V24"=>"6",
"UNC0101,V24"=>"1",
"UNC0102,V24"=>"1",
"UNC0103,V24"=>"1",
"UNC0104,V24"=>"1",
"UNC0105,V24"=>"1",
"UNC0106,V24"=>"2",
"UNC0107,V24"=>"6",
"UNC0111,V24"=>"1",
"UNC0112,V24"=>"2",
"UNC0114,V24"=>"2",
"UNC0115,V24"=>"6",
"UNC0116,V24"=>"1",
"UNC0119,V24"=>"2",
"UNC0120,V24"=>"1",
"UNC0121,V24"=>"2",
"UNC0122,V24"=>"1",
"UNC0123,V24"=>"3",
"UNC0124,V24"=>"1",
"UNC0127,V24"=>"1",
"UNC0129,V24"=>"6",
"UNC0131,V24"=>"1",
"UNC0132,V24"=>"2",
"UNC0133,V24"=>"2",
"UNC0135,V24"=>"3",
"UNC0137,V24"=>"1",
"UNC0139,V24"=>".",
"UNC0143,V24"=>"1",
"UNC0146,V24"=>"1",
"UNC0147,V24"=>"2",
"UNC0148,V24"=>"2",
"UNC0150,V24"=>"1",
"UNC0154,V24"=>"2",
"UNC0156,V24"=>"2",
"UNC0158,V24"=>"1",
"UNC0183,V24"=>"1",
"UNC0185,V24"=>"9",
"UNC0186,V24"=>"1",
"UNC0189,V24"=>"2",
"UNC0192,V24"=>"2",
"UNC0194,V24"=>"2",
"UNC0195,V24"=>"2",
"UNC0196,V24"=>"6",
"UNC0199,V24"=>"1",
"UNC0201,V24"=>"2",
"UNC0206,V24"=>"1",
"UNC0207,V24"=>"1",
"UNC0214,V24"=>"2",
"UNC0216,V24"=>"1",
"UNC0221,V24"=>"1",
"UNC0222,V24"=>"1",
"UNC0223,V24"=>".",
"UNC0226,V24"=>"9",
"UNC0227,V24"=>"2",
"UNC0228,V24"=>".",
"UNC0229,V24"=>"2",
"UNC0230,V24"=>"5",
"UNC0234,V24"=>".",
"UNC0235,V24"=>".",
"UNC0237,V24"=>".",
"UNC0238,V24"=>".",
"UNC0239,V24"=>".",
"UNC0240,V24"=>".",
"UNC0241,V24"=>"1",
"UNC0243,V24"=>".",
"UNC0244,V24"=>".",
"UNC0245,V24"=>".",
"UNC0246,V24"=>".",
"UNC0248,V24"=>".",
"UNC0250,V24"=>"5",
"UNC1000,V24"=>"2",
"UNC1001,V24"=>"2",
"UNC1002,V24"=>"2",
"UNC1003,V24"=>"2",
"UNC1006,V24"=>"2",
"UNC1008,V24"=>"1",
"UNC1009,V24"=>"1",
"UNC1012,V24"=>"2",
"UNC1013,V24"=>"1",
"UNC1014,V24"=>"1",
"UNC1015,V24"=>"1",
"UNC1016,V24"=>"2",
"UNC1018,V24"=>"2",
"UNC1020,V24"=>"1",
"UNC1021,V24"=>".",
"UNC1023,V24"=>"2",
"UNC1024,V24"=>"2",
"UNC1025,V24"=>"3",
"UNC1027,V24"=>"1",
"UNC1028,V24"=>".",
"UNC1029,V24"=>"1",
"UNC1034,V24"=>".");

public $ADOS_RRB_CSS = array("PHI0000,V24"=>"7",
"PHI0002,V24"=>"6",
"PHI0003,V24"=>"7",
"PHI0005,V24"=>"7",
"PHI0006,V24"=>"1",
"PHI0007,V24"=>"5",
"PHI0009,V24"=>"8",
"PHI0010,V24"=>"6",
"PHI0014,V24"=>"6",
"PHI0015,V24"=>"7",
"PHI0016,V24"=>"7",
"PHI0023,V24"=>"5",
"PHI0024,V24"=>"1",
"PHI0040,V24"=>"1",
"PHI0045,V24"=>"7",
"PHI0047,V24"=>"5",
"PHI0050,V24"=>"7",
"PHI0052,V24"=>"10",
"PHI0055,V24"=>"1",
"PHI0058,V24"=>"7",
"PHI0059,V24"=>"6",
"PHI0064,V24"=>"1",
"PHI0068,V24"=>"1",
"PHI0070,V24"=>"5",
"PHI0071,V24"=>"8",
"PHI0072,V24"=>"7",
"PHI0077,V24"=>"5",
"PHI0078,V24"=>"1",
"PHI0081,V24"=>"1",
"PHI0084,V24"=>"1",
"PHI0088,V24"=>"5",
"PHI0089,V24"=>"6",
"PHI0091,V24"=>"1",
"PHI0093,V24"=>"5",
"PHI0096,V24"=>"1",
"PHI0098,V24"=>"7",
"PHI0101,V24"=>"5",
"PHI0106,V24"=>"1",
"PHI0109,V24"=>"6",
"PHI0110,V24"=>"6",
"PHI0112,V24"=>"7",
"PHI0115,V24"=>"1",
"PHI0116,V24"=>"1",
"PHI0117,V24"=>"5",
"PHI0119,V24"=>"5",
"PHI0122,V24"=>"5",
"PHI0125,V24"=>"5",
"PHI0126,V24"=>"1",
"PHI0136,V24"=>"6",
"PHI0139,V24"=>"1",
"PHI0141,V24"=>"1",
"PHI0142,V24"=>"6",
"PHI0144,V24"=>"1",
"PHI0146,V24"=>"1",
"PHI0149,V24"=>"6",
"PHI0150,V24"=>"7",
"PHI0151,V24"=>"6",
"PHI0152,V24"=>"1",
"PHI0153,V24"=>"1",
"PHI0154,V24"=>"6",
"PHI0155,V24"=>"6",
"PHI0159,V24"=>"1",
"PHI0161,V24"=>"1",
"PHI0167,V24"=>"1",
"PHI0170,V24"=>"5",
"PHI0171,V24"=>"6",
"PHI0173,V24"=>"7",
"PHI0176,V24"=>"1",
"PHI0177,V24"=>"5",
"PHI0182,V24"=>"1",
"PHI0187,V24"=>"5",
"PHI0189,V24"=>"1",
"PHI0190,V24"=>"7",
"PHI0192,V24"=>"8",
"PHI0193,V24"=>".",
"PHI0194,V24"=>".",
"PHI0201,V24"=>"1",
"PHI0205,V24"=>"1",
"PHI0206,V24"=>"6",
"PHI0207,V24"=>"6",
"PHI0209,V24"=>"5",
"PHI0212,V24"=>"1",
"PHI0215,V24"=>"1",
"PHI0216,V24"=>"6",
"PHI0217,V24"=>"1",
"PHI0218,V24"=>"1",
"PHI0219,V24"=>"1",
"PHI0221,V24"=>"7",
"PHI0222,V24"=>"1",
"PHI0223,V24"=>"5",
"PHI0224,V24"=>"1",
"PHI0225,V24"=>"6",
"PHI0226,V24"=>"6",
"PHI0235,V24"=>"1",
"PHI0239,V24"=>"1",
"PHI0240,V24"=>"1",
"PHI0241,V24"=>"1",
"PHI0242,V24"=>"1",
"PHI0244,V24"=>"5",
"PHI0246,V24"=>"6",
"PHI0247,V24"=>"1",
"PHI0248,V24"=>"5",
"PHI0250,V24"=>"1",
"PHI0251,V24"=>"1",
"PHI0256,V24"=>"1",
"PHI0260,V24"=>"1",
"PHI0261,V24"=>"5",
"PHI0262,V24"=>"7",
"PHI0263,V24"=>"1",
"PHI0264,V24"=>"1",
"PHI0265,V24"=>"6",
"PHI0272,V24"=>"7",
"PHI0273,V24"=>"5",
"PHI0274,V24"=>"1",
"PHI0275,V24"=>"5",
"PHI0276,V24"=>"1",
"PHI1001,V24"=>"1",
"PHI1005,V24"=>"1",
"PHI1007,V24"=>".",
"PHI1009,V24"=>".",
"PHI1010,V24"=>".",
"PHI1013,V24"=>".",
"PHI1018,V24"=>".",
"PHI1020,V24"=>".",
"PHI1021,V24"=>".",
"PHI1022,V24"=>".",
"PHI1024,V24"=>".",
"PHI1026,V24"=>".",
"PHI1029,V24"=>".",
"PHI1030,V24"=>".",
"PHI1031,V24"=>".",
"PHI1032,V24"=>".",
"PHI1037,V24"=>".",
"PHI1038,V24"=>".",
"PHI1042,V24"=>".",
"PHI1046,V24"=>".",
"PHI1047,V24"=>".",
"PHI1049,V24"=>".",
"PHI1050,V24"=>".",
"PHI1051,V24"=>".",
"PHI1052,V24"=>".",
"PHI1053,V24"=>".",
"PHI1056,V24"=>".",
"PHI1058,V24"=>".",
"SEA0001,V24"=>"5",
"SEA0002,V24"=>"7",
"SEA0004,V24"=>"5",
"SEA0005,V24"=>"6",
"SEA0007,V24"=>"1",
"SEA0008,V24"=>".",
"SEA0009,V24"=>"6",
"SEA0012,V24"=>"6",
"SEA0014,V24"=>"7",
"SEA0015,V24"=>"7",
"SEA0016,V24"=>"5",
"SEA0018,V24"=>"5",
"SEA0022,V24"=>"6",
"SEA0029,V24"=>"5",
"SEA0030,V24"=>"1",
"SEA0032,V24"=>"1",
"SEA0034,V24"=>"9",
"SEA0036,V24"=>"1",
"SEA0037,V24"=>"5",
"SEA0041,V24"=>"1",
"SEA0050,V24"=>"1",
"SEA0060,V24"=>"5",
"SEA0062,V24"=>"5",
"SEA0065,V24"=>"5",
"SEA0067,V24"=>"1",
"SEA0068,V24"=>"1",
"SEA0069,V24"=>"5",
"SEA0072,V24"=>"5",
"SEA0074,V24"=>"6",
"SEA0077,V24"=>"1",
"SEA0078,V24"=>"1",
"SEA0079,V24"=>"1",
"SEA0092,V24"=>"1",
"SEA0099,V24"=>"7",
"SEA0102,V24"=>"1",
"SEA0103,V24"=>"1",
"SEA0106,V24"=>"1",
"SEA0107,V24"=>"8",
"SEA0108,V24"=>"1",
"SEA0110,V24"=>"1",
"SEA0111,V24"=>"1",
"SEA0112,V24"=>"1",
"SEA0117,V24"=>"1",
"SEA0118,V24"=>"1",
"SEA0119,V24"=>"5",
"SEA0120,V24"=>"6",
"SEA0121,V24"=>"1",
"SEA0122,V24"=>"1",
"SEA0123,V24"=>"1",
"SEA0124,V24"=>"5",
"SEA0125,V24"=>"5",
"SEA0130,V24"=>"1",
"SEA0131,V24"=>".",
"SEA0132,V24"=>"1",
"SEA0133,V24"=>".",
"SEA0136,V24"=>"5",
"SEA0137,V24"=>"1",
"SEA0141,V24"=>"6",
"SEA0142,V24"=>"6",
"SEA0143,V24"=>"1",
"SEA0144,V24"=>"6",
"SEA0145,V24"=>"1",
"SEA0147,V24"=>"1",
"SEA0148,V24"=>"7",
"SEA0150,V24"=>"5",
"SEA0151,V24"=>"1",
"SEA0152,V24"=>"1",
"SEA0153,V24"=>"1",
"SEA0154,V24"=>"1",
"SEA0157,V24"=>"1",
"SEA0158,V24"=>"1",
"SEA0160,V24"=>"6",
"SEA0161,V24"=>"5",
"SEA0162,V24"=>"1",
"SEA0163,V24"=>"10",
"SEA0165,V24"=>"1",
"SEA0177,V24"=>"5",
"SEA0178,V24"=>"6",
"SEA0179,V24"=>"1",
"SEA0183,V24"=>"1",
"SEA0184,V24"=>"5",
"SEA0186,V24"=>"1",
"SEA0193,V24"=>"1",
"SEA0194,V24"=>"8",
"SEA0195,V24"=>"1",
"SEA0196,V24"=>"1",
"SEA0197,V24"=>"1",
"SEA0201,V24"=>"6",
"SEA0202,V24"=>"7",
"SEA0210,V24"=>"8",
"SEA0211,V24"=>"1",
"SEA0213,V24"=>"6",
"SEA0214,V24"=>"1",
"SEA0215,V24"=>"5",
"SEA0221,V24"=>"1",
"SEA0222,V24"=>"1",
"SEA0225,V24"=>"7",
"SEA0233,V24"=>"1",
"SEA0235,V24"=>"5",
"SEA0237,V24"=>"6",
"SEA0238,V24"=>"5",
"SEA0245,V24"=>"1",
"SEA0246,V24"=>"6",
"SEA0247,V24"=>"5",
"SEA0250,V24"=>"6",
"SEA0251,V24"=>"1",
"SEA0254,V24"=>"5",
"SEA0257,V24"=>"1",
"SEA0258,V24"=>"1",
"SEA0262,V24"=>"1",
"SEA0268,V24"=>".",
"SEA0269,V24"=>"7",
"SEA1000,V24"=>"6",
"SEA1001,V24"=>"7",
"SEA1004,V24"=>"10",
"SEA1006,V24"=>"6",
"SEA1008,V24"=>"9",
"SEA1009,V24"=>"6",
"SEA1012,V24"=>"1",
"SEA1013,V24"=>"10",
"SEA1017,V24"=>"6",
"SEA1018,V24"=>"1",
"SEA1019,V24"=>"5",
"SEA1020,V24"=>"5",
"SEA1022,V24"=>"1",
"SEA1025,V24"=>".",
"SEA1026,V24"=>"5",
"SEA1027,V24"=>"5",
"SEA1029,V24"=>".",
"SEA1030,V24"=>"1",
"SEA1031,V24"=>"5",
"SEA1032,V24"=>"1",
"SEA1033,V24"=>"6",
"SEA1034,V24"=>"6",
"SEA1036,V24"=>"1",
"SEA1038,V24"=>"10",
"SEA1039,V24"=>"1",
"SEA1040,V24"=>"5",
"SEA1041,V24"=>"6",
"SEA1042,V24"=>".",
"SEA1043,V24"=>"5",
"SEA1044,V24"=>"6",
"SEA1045,V24"=>"5",
"SEA1047,V24"=>"1",
"SEA1048,V24"=>"1",
"SEA1050,V24"=>"8",
"SEA1052,V24"=>"1",
"SEA1054,V24"=>"6",
"SEA1055,V24"=>"7",
"SEA1057,V24"=>".",
"STL0000,V24"=>"7",
"STL0001,V24"=>".",
"STL0002,V24"=>"5",
"STL0003,V24"=>"1",
"STL0004,V24"=>"1",
"STL0005,V24"=>"1",
"STL0006,V24"=>"5",
"STL0007,V24"=>".",
"STL0009,V24"=>"5",
"STL0010,V24"=>"1",
"STL0011,V24"=>"1",
"STL0013,V24"=>"1",
"STL0016,V24"=>"5",
"STL0017,V24"=>"1",
"STL0019,V24"=>".",
"STL0022,V24"=>"1",
"STL0023,V24"=>"1",
"STL0025,V24"=>"5",
"STL0026,V24"=>"7",
"STL0028,V24"=>"5",
"STL0029,V24"=>"1",
"STL0030,V24"=>"5",
"STL0031,V24"=>".",
"STL0032,V24"=>"5",
"STL0034,V24"=>"7",
"STL0038,V24"=>"5",
"STL0040,V24"=>"7",
"STL0044,V24"=>"5",
"STL0045,V24"=>"1",
"STL0046,V24"=>".",
"STL0048,V24"=>"5",
"STL0049,V24"=>"1",
"STL0051,V24"=>"1",
"STL0054,V24"=>"5",
"STL0057,V24"=>"1",
"STL0061,V24"=>"5",
"STL0063,V24"=>"5",
"STL0064,V24"=>"1",
"STL0070,V24"=>"1",
"STL0077,V24"=>"1",
"STL0079,V24"=>"1",
"STL0080,V24"=>"1",
"STL0081,V24"=>"1",
"STL0084,V24"=>"1",
"STL0085,V24"=>"1",
"STL0091,V24"=>"1",
"STL0093,V24"=>"1",
"STL0097,V24"=>"1",
"STL0107,V24"=>"1",
"STL0108,V24"=>"8",
"STL0109,V24"=>"5",
"STL0111,V24"=>"1",
"STL0112,V24"=>"1",
"STL0113,V24"=>".",
"STL0115,V24"=>"7",
"STL0116,V24"=>"5",
"STL0118,V24"=>"1",
"STL0126,V24"=>"5",
"STL0128,V24"=>"1",
"STL0129,V24"=>"5",
"STL0132,V24"=>"1",
"STL0133,V24"=>"6",
"STL0136,V24"=>"5",
"STL0138,V24"=>"1",
"STL0140,V24"=>"5",
"STL0143,V24"=>"7",
"STL0144,V24"=>"1",
"STL0149,V24"=>"1",
"STL0150,V24"=>"1",
"STL0152,V24"=>"5",
"STL0159,V24"=>"6",
"STL0163,V24"=>"8",
"STL0167,V24"=>"5",
"STL0168,V24"=>"7",
"STL0173,V24"=>"1",
"STL0174,V24"=>"5",
"STL0176,V24"=>"6",
"STL0178,V24"=>"6",
"STL0181,V24"=>"5",
"STL0183,V24"=>"5",
"STL0187,V24"=>"5",
"STL0188,V24"=>"1",
"STL0192,V24"=>"1",
"STL0193,V24"=>"7",
"STL0194,V24"=>"8",
"STL0195,V24"=>"5",
"STL0196,V24"=>".",
"STL0198,V24"=>"5",
"STL0199,V24"=>".",
"STL0200,V24"=>"9",
"STL0210,V24"=>"10",
"STL0213,V24"=>"7",
"STL0217,V24"=>"1",
"STL0218,V24"=>"5",
"STL0226,V24"=>"1",
"STL0228,V24"=>"1",
"STL0234,V24"=>"1",
"STL0236,V24"=>"5",
"STL0241,V24"=>"5",
"STL0243,V24"=>"1",
"STL0248,V24"=>"1",
"STL0249,V24"=>"1",
"STL0250,V24"=>"1",
"STL0252,V24"=>"1",
"STL0254,V24"=>".",
"STL0255,V24"=>".",
"STL0257,V24"=>"1",
"STL0258,V24"=>"1",
"STL0260,V24"=>".",
"STL0261,V24"=>"1",
"STL0263,V24"=>"1",
"STL0265,V24"=>"5",
"STL0266,V24"=>"9",
"STL0271,V24"=>"1",
"STL0272,V24"=>"1",
"STL0275,V24"=>"1",
"STL0279,V24"=>"6",
"STL0282,V24"=>"1",
"STL0285,V24"=>".",
"STL0289,V24"=>"8",
"STL0290,V24"=>"1",
"STL0291,V24"=>"6",
"STL0294,V24"=>".",
"STL0298,V24"=>".",
"STL0299,V24"=>"5",
"STL0301,V24"=>"7",
"STL0304,V24"=>"6",
"STL0305,V24"=>"1",
"STL0308,V24"=>"1",
"STL0311,V24"=>"9",
"STL0313,V24"=>"7",
"STL0314,V24"=>"1",
"STL0315,V24"=>"5",
"STL0318,V24"=>"8",
"STL0319,V24"=>"7",
"STL0332,V24"=>"1",
"STL0333,V24"=>"1",
"STL0335,V24"=>"5",
"STL0336,V24"=>"6",
"STL0337,V24"=>"8",
"STL1004,V24"=>"1",
"STL1005,V24"=>"6",
"STL1006,V24"=>"1",
"STL1007,V24"=>"1",
"STL1008,V24"=>"6",
"STL1011,V24"=>".",
"STL1025,V24"=>"6",
"STL1027,V24"=>"1",
"STL1028,V24"=>".",
"STL1030,V24"=>"1",
"STL1033,V24"=>"1",
"STL1034,V24"=>"1",
"STL1036,V24"=>"1",
"STL1037,V24"=>"5",
"STL1039,V24"=>"6",
"STL1043,V24"=>"5",
"STL1044,V24"=>"1",
"STL1045,V24"=>"1",
"STL1050,V24"=>"5",
"STL1051,V24"=>".",
"STL1052,V24"=>"1",
"STL1054,V24"=>".",
"UNC0003,V24"=>"1",
"UNC0005,V24"=>"1",
"UNC0006,V24"=>"1",
"UNC0007,V24"=>"7",
"UNC0011,V24"=>"6",
"UNC0012,V24"=>"5",
"UNC0013,V24"=>"6",
"UNC0015,V24"=>".",
"UNC0016,V24"=>"1",
"UNC0017,V24"=>"1",
"UNC0018,V24"=>"1",
"UNC0019,V24"=>"7",
"UNC0020,V24"=>"1",
"UNC0021,V24"=>"1",
"UNC0022,V24"=>"1",
"UNC0023,V24"=>"1",
"UNC0025,V24"=>"1",
"UNC0027,V24"=>"5",
"UNC0030,V24"=>"5",
"UNC0031,V24"=>"1",
"UNC0032,V24"=>"1",
"UNC0033,V24"=>"1",
"UNC0035,V24"=>"7",
"UNC0040,V24"=>"1",
"UNC0041,V24"=>"1",
"UNC0042,V24"=>"1",
"UNC0044,V24"=>"6",
"UNC0045,V24"=>"1",
"UNC0046,V24"=>"6",
"UNC0048,V24"=>"1",
"UNC0049,V24"=>"1",
"UNC0050,V24"=>"5",
"UNC0051,V24"=>"1",
"UNC0053,V24"=>".",
"UNC0054,V24"=>"1",
"UNC0055,V24"=>"1",
"UNC0057,V24"=>"1",
"UNC0059,V24"=>"5",
"UNC0064,V24"=>"1",
"UNC0065,V24"=>"1",
"UNC0066,V24"=>"5",
"UNC0070,V24"=>"5",
"UNC0071,V24"=>"1",
"UNC0072,V24"=>"6",
"UNC0073,V24"=>"8",
"UNC0074,V24"=>"1",
"UNC0076,V24"=>"6",
"UNC0077,V24"=>"8",
"UNC0078,V24"=>"1",
"UNC0079,V24"=>"1",
"UNC0080,V24"=>"6",
"UNC0084,V24"=>"1",
"UNC0086,V24"=>"8",
"UNC0087,V24"=>"1",
"UNC0088,V24"=>"1",
"UNC0090,V24"=>"1",
"UNC0091,V24"=>"7",
"UNC0092,V24"=>"1",
"UNC0094,V24"=>"5",
"UNC0095,V24"=>"1",
"UNC0096,V24"=>"5",
"UNC0097,V24"=>"6",
"UNC0099,V24"=>".",
"UNC0100,V24"=>"10",
"UNC0101,V24"=>"1",
"UNC0102,V24"=>"1",
"UNC0103,V24"=>"1",
"UNC0104,V24"=>"1",
"UNC0105,V24"=>"1",
"UNC0106,V24"=>"1",
"UNC0107,V24"=>"5",
"UNC0111,V24"=>"1",
"UNC0112,V24"=>"1",
"UNC0114,V24"=>"1",
"UNC0115,V24"=>"8",
"UNC0116,V24"=>"6",
"UNC0119,V24"=>"1",
"UNC0120,V24"=>"1",
"UNC0121,V24"=>"5",
"UNC0122,V24"=>"1",
"UNC0123,V24"=>"1",
"UNC0124,V24"=>"1",
"UNC0127,V24"=>"1",
"UNC0129,V24"=>"1",
"UNC0131,V24"=>"1",
"UNC0132,V24"=>"5",
"UNC0133,V24"=>"1",
"UNC0135,V24"=>"1",
"UNC0137,V24"=>"1",
"UNC0139,V24"=>".",
"UNC0143,V24"=>"1",
"UNC0146,V24"=>"1",
"UNC0147,V24"=>"1",
"UNC0148,V24"=>"1",
"UNC0150,V24"=>"1",
"UNC0154,V24"=>"1",
"UNC0156,V24"=>"5",
"UNC0158,V24"=>"1",
"UNC0183,V24"=>"1",
"UNC0185,V24"=>"1",
"UNC0186,V24"=>"1",
"UNC0189,V24"=>"5",
"UNC0192,V24"=>"1",
"UNC0194,V24"=>"1",
"UNC0195,V24"=>"5",
"UNC0196,V24"=>"5",
"UNC0199,V24"=>"1",
"UNC0201,V24"=>"1",
"UNC0206,V24"=>"1",
"UNC0207,V24"=>"6",
"UNC0214,V24"=>"5",
"UNC0216,V24"=>"1",
"UNC0221,V24"=>"1",
"UNC0222,V24"=>"1",
"UNC0223,V24"=>".",
"UNC0226,V24"=>"1",
"UNC0227,V24"=>"5",
"UNC0228,V24"=>".",
"UNC0229,V24"=>"5",
"UNC0230,V24"=>"8",
"UNC0234,V24"=>".",
"UNC0235,V24"=>".",
"UNC0237,V24"=>".",
"UNC0238,V24"=>".",
"UNC0239,V24"=>".",
"UNC0240,V24"=>".",
"UNC0241,V24"=>"5",
"UNC0243,V24"=>".",
"UNC0244,V24"=>".",
"UNC0245,V24"=>".",
"UNC0246,V24"=>".",
"UNC0248,V24"=>".",
"UNC0250,V24"=>"10",
"UNC1000,V24"=>"1",
"UNC1001,V24"=>"1",
"UNC1002,V24"=>"1",
"UNC1003,V24"=>"1",
"UNC1006,V24"=>"5",
"UNC1008,V24"=>"5",
"UNC1009,V24"=>"1",
"UNC1012,V24"=>"1",
"UNC1013,V24"=>"5",
"UNC1014,V24"=>"1",
"UNC1015,V24"=>"1",
"UNC1016,V24"=>"1",
"UNC1018,V24"=>"1",
"UNC1020,V24"=>"1",
"UNC1021,V24"=>".",
"UNC1023,V24"=>"1",
"UNC1024,V24"=>"1",
"UNC1025,V24"=>"5",
"UNC1027,V24"=>"1",
"UNC1028,V24"=>".",
"UNC1029,V24"=>"5",
"UNC1034,V24"=>".");

    /**
     * Construct the object used for importing data. This initiates
     * a pointer to both the CouchDB and MySQL DB handler, which is
     * used instead of the ::singleton() methods so that the test
     * suite can mock them out for testing.
     * 
     * This is a constructor called automagically by PHP, it should not be called 
     * manually. 
     *
     * @return null
     */
    function __construct()
    {
        $factory = NDB_Factory::singleton();
        $this->SQLDB = $factory->database();
        $this->CouchDB = $factory->CouchDB();
    }

    /**
     * Update (or create) the CouchDB document for the data dictionary for
     * this derived variable.
     *
     * @return null
     */
    function updateDataDict()
    {
print "updateDataDict"; 

        $this->CouchDB->replaceDoc(
            "DataDictionary:ADOS_Derived",
            array(
                'Meta' => array(
                    'DataDict' => true
                ),
                'DataDictionary' => array(
                    'ADOS_Derived' => array(
                        'Administration' => array(
                            'Type' => "enum('None', 'Partial', 'All')",
                            'Description' => 'Administration for hello'
                        ),
                        'Data_entry' => array(
                            'Type' => "enum('In Progress', 'Complete')",
                            'Description' => 'Data entry status for hello'
                        ),
                        'Validity' => array(
                            'Type' => "enum('Questionable', 'Invalid', 'Valid')",
                            'Description' => 'Validity of data for hello'
                        ),
                        'Conflicts_Exist' => array(
                            'Type'        => "enum('Yes', 'No')",
                            'Description' => 'Conflicts exist for instrument data entry'
                        ),
                        'DDE_Complete' => array(
                            'Type'        => "enum('Yes', 'No')",
                            'Description' => 
                            'Double Data Entry was completed for instrument'
                        ),
                        'Candidate_Age' => array(
                            'Type' => 'varchar(255)',
                            'Description' => 'Age of Candidate'),
                        'ADOS_Version' => array(
                            'Type' => 
                            "enum('ados1_module1','ados1_module2','ados1_module3'"
                            . ",'ados2_module1','ados2_module2','ados2_module3')",
                            'Description' => 'Version of ADOS Administered'
                        ),
                        'social_affect_total' => array(
                            'Type' => "varchar(255)",
                            'Description' => 'Social Affect Total score'
                        ),
                        'restricted_repetitive_behavior_total' => array(
                            'Type' => "varchar(255)",
                            'Description' => 
                            'Restricted Repetitive Behaviour Total score'
                        ),
                        'social_affect_restricted_repetitive_behavior_total' => array(
                            'Type' => "varchar(255)",
                            'Description' => 
                            'Social Affect Restricted Repetitive Behaviour'
                            . ' Total score'
                        ),
                        'ADOS_classification' => array(
                            'Type' => "varchar(255)",
                            'Description' => 'ADOS Diagnosis'
                        ),
                        'social_affect_gotham_weighted' => array(
                            'Type' => "varchar(255)",
                            'Description' => 'Weighted Social Affect score'
                        ),
                        'restricted_repetitive_gotham_weighted' => array(
                            'Type' => "varchar(255)",
                            'Description' => 'Weighted Restricted Repetitive score'
                        ),
                        'gotham_weighted_score' => array(
                            'Type' => "varchar(255)",
                            'Description' => 'Weighted ADOS Score'
                        ),
                        'severity_score_lookup' => array(
                            'Type' => "varchar(255)",
                            'Description' => 'ADOS severity lookup'
                        ),
                        'ADOS_SA_CSS' => array(
                            'Type' => "varchar(255)",
                            'Description' => 'ADOS_SA_CSS'
                        ),
                        'ADOS_RRB_CSS' => array(
                            'Type' => "varchar(255)",
                            'Description' => 'ADOS_RRB_CSS'
                        )
                    )
                )
            )
        );
    }

    /**
     * Gets the ADOS module that was Administered at a particular
     * SessionID
     *
     * @param int $SessionID The Session
     *
     * @return string Test_name of ADOS module. null if not found
     */
    function getADOSModule($SessionID)
    {
        $rows = $this->SQLDB->pselect(
            "SELECT Test_name, Administration FROM flag " .
            "WHERE SessionID=:SID AND Test_name LIKE 'ados%'" .
            " AND CommentID NOT LIKE 'DDE%'",
            array('SID' => $SessionID)
        ); 
        foreach ($rows as $row) {
            if ($row['Administration'] === 'All') {
                return $row['Test_name'];
            }
        }

        return null;
    }

    /**
     * Update an individual session's document. This will find the
     * appropriate ADOS module that was administered, and create the
     * document containing scores from that module.
     *
     * @param int $SessionID The session to be updated
     *
     * @return null
     */
    function updateCandidate($SessionID)
    {
        $ADOSModule = $this->getADOSModule($SessionID);

	if (is_null($ADOSModule)) {
            return;
        }

print "ADOSModule: $ADOSModule\n";
        $Fields = array(
            'f.CommentID',
            'c.PSCID',
            's.Visit_label',
            'f.Administration', 'f.Data_entry', 'f.Validity',
            /* Special cases, do them later */
            //'Conflicts_Exist', 'DDE_Complete', 
            'i.Candidate_Age',
            /* Not a field, just the value of getADOSModule,
             * but don't forget to add it in the replaceDoc
             */
            // 'ADOS Version',  
            'i.social_affect_total',
            'i.restricted_repetitive_behavior_total',
            'i.social_affect_restricted_repetitive_behavior_total',
            'i.ADOS_classification',
            'i.social_affect_gotham_weighted',
            'i.restricted_repetitive_gotham_weighted',
            'i.gotham_weighted_score',
            'i.severity_score_lookup'
        );

        $selectq =  "SELECT " . join(",", $Fields) .
            " FROM flag f LEFT JOIN ". $ADOSModule ." i USING (CommentID)" .
            " LEFT JOIN session s ON (s.ID=f.SessionID)" .
            " LEFT JOIN candidate c USING (CandID) " . 
            "WHERE f.Test_name=:AM AND f.SessionID=:SID AND s.Active='Y'" .
            " AND c.Active='Y' AND f.CommentID NOT LIKE 'DDE%'";

//        print "selectq: " . $selectq . "\n";
        $row = $this->SQLDB->pselectRow($selectq,
            array(
                "AM"  => $ADOSModule,
                'SID' => $SessionID
            )
        );
        if ($row === array()) {
            return;
        }
        $PSCID=$row['PSCID'];
        $Visit_label=$row['Visit_label'];

        print $this->CouchDB->replaceDoc(
            "ADOS_Derived:$PSCID" . "_" . $Visit_label,
            array(
                'Meta' => array(
                    'DocType'    => 'ADOS_Derived',
                    'identifier' => array(
                        $PSCID,$Visit_label
                    )
                ),
                'data' => array(
                    'Administration' => $row['Administration'],
                    'Data_entry'     => $row['Data_entry'],
                    'Validity'       => $row['Validity'],
                    'Candidate_Age'  => $row['Candidate_Age'],
                    'ADOS_Version'   => $ADOSModule,
                    'social_affect_total'
                       => $row['social_affect_total'],
                    'restricted_repetitive_behavior_total'
                       => $row['restricted_repetitive_behavior_total'],
                    'social_affect_restricted_repetitive_behavior_total'
                       => $row['social_affect_restricted_repetitive_behavior_total'],
                    'ADOS_classification'
                       => $row['ADOS_classification'],
                    'social_affect_gotham_weighted'
                       => $row['social_affect_gotham_weighted'],
                    'restricted_repetitive_gotham_weighted'
                       => $row['restricted_repetitive_gotham_weighted'],
                    'gotham_weighted_score'
                       => $row['gotham_weighted_score'],
                    'severity_score_lookup'
                       => $row['severity_score_lookup'],
                    'ADOS_SA_CSS'
                       => $this->ADOS_SA_CSS[$PSCID .",". $Visit_label],
                    'ADOS_RRB_CSS'
                       => $this->ADOS_RRB_CSS[$PSCID .",". $Visit_label]
                )
            )
        );
    }

    /**
     * Get a list of sessions which must be created/updated and then updates
     * each one.
     *
     * @return null
     */
    function updateCandidateDocs()
    {
        $sessions = $this->SQLDB->pselect(
            "SELECT s.ID FROM session s JOIN candidate c USING (CandID)" .
            " WHERE c.Active='Y' AND s.Active='Y' " .
            "AND s.Visit_label in ('V24', 'V36', 'V37Plus')",
            array()
        );
        foreach ($sessions as $row) {
            $this->updateCandidate($row['ID']);
        }
    }

    /**
     * Initiate the script, called automatically if not run by
     * UnitTesting suite.
     *
     * @return null
     */
    function run()
    {
        $this->updateDataDict();
        $this->updateCandidateDocs();
    }
}
// Don't run if we're doing the unit tests, the unit test will call run..
if (!class_exists('UnitTestCase')) {
    $Runner = new CouchDBADOSImporter();
    $Runner->run();
}
?>
